<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tests/Tests_class.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tests/Tests_class.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class test_IU
 * @description Clase principal para la gestión y ejecución de tests de la interfaz de usuario.
 * Maneja la ejecución de tests, la visualización de resultados y la gestión de columnas en las tablas de resultados.
 */
class test_IU {
  /**
   * @constructor
   * @param {string} entidad - Nombre de la entidad a testear
   * @param {object} instance - Instancia de la entidad a testear
   */
  constructor(entidad, instance) {
    this.dom = new Dom();
    this.entidad = entidad;
    this.instance = instance;

    // Hacer la referencia global para los onclick
    window.testInstance = this;

    // mostrar boton de test una vez creada la clase de entidad
    this.dom.mostrar_boton_test();
  }

  /**
   * @method modificarColumnasTest
   * @description Modifica las columnas visibles en la tabla de resultados de tests
   * @param {string} columna - Nombre de la columna a modificar
   */
  modificarColumnasTest(columna) {
    this.dom.modificarColumnasTest(columna);
  }

  /**
   * @method resetColumnasTest
   * @description Restablece las columnas visibles a su configuración por defecto
   */
  resetColumnasTest() {
    this.dom.resetColumnasTest();
  }

  /**
   * @method test_run
   * @description Ejecuta todos los tests definidos para la entidad
   */
  test_run() {
    document.getElementById("div_IU_test").style.display = "block";
    document.getElementById("resultadodeftest").innerHTML = "";
    document.getElementById("tablaresultadostest").innerHTML = "";
    document.getElementById("resultadodefpruebas").innerHTML = "";
    document.getElementById("tablaresultadosprueba").innerHTML = "";
    document.getElementById("resultadotest").innerHTML = "";
    document.getElementById("salidaresultadosprueba").innerHTML = "";
    document.getElementById("titulo_modal").className =
      "titulo_modal_" + this.entidad;

    if (typeof this.dom.mostrarModal === "function") {
      this.dom.mostrarModal(); // Asegura que se llame al método de la subclase
    } else {
      console.error("mostrarModal no está definido en esta instancia");
    }
    this.resolve_def_test();
    this.resolve_pruebas();

    this.array_def = eval(this.entidad + "_def_tests");
    this.array_tests = eval(this.entidad + "_tests");
    this.array_tests_file = eval(this.entidad + "_tests_files");

    this.test_entidad();
    this.test_entidad_files();
  }

  /**
   * @method resolve_def_test
   * @description Resuelve y verifica las definiciones de los tests
   */
  resolve_def_test() {
    this.verificarDefTest();
  }

  /**
   * @method resolve_pruebas
   * @description Resuelve y verifica las pruebas de los tests
   */
  resolve_pruebas() {
    this.verificarPruebas();
    this.verificarPruebas_file();
  }

  // En el método test_entidad(), reemplaza la construcción de salidatest:
  test_entidad(){
    this.validaciones = new Dom_validations(new Validaciones_Atomicas(), this.entidad);
    this.dom.construirDomTest(); // Usar el nuevo método
    
    // Construir encabezado usando el nuevo método
    let salidatest = this.dom.crearEncabezadoTest(this.dom.columnas_test_disponibles);
    
    for (let i = 0; i &lt; this.array_tests.length; i++) {
        let campotest = this.array_tests[i][1];
        let numdeftest = this.array_tests[i][2];
        let numprueba = this.array_tests[i][3];
        let acciontest = this.array_tests[i][4];
        let valortest = this.array_tests[i][5];
        let respuestatest = this.array_tests[i][6];
        
        // Cargo formulario limpio
        this.instance.cargar_formulario(acciontest);
    
        // Cargo el botón porque sino da un error en la función de dibujado del mensaje de error
        let botonsumit = document.createElement('input');
        botonsumit.id = 'submit_button';
        document.getElementById('IU_form').append(botonsumit);
    
        // Recupero la definición del test correspondiente
        let def = this.devolver_def(numdeftest);
    
        // Asigno el valor de prueba al campo correspondiente
        document.getElementById(campotest).value = valortest;
    
        // Llamo a la función de validación del campo según su acción
        let resultadotest = this.validaciones.comprobarCampo(campotest, acciontest);
        
        // Compruebo si el resultado del test y la respuesta esperada es la misma
        let resultadoestetest = (respuestatest === resultadotest) ? 'CORRECTO' : 'INCORRECTO';
    
        // Crear objeto con los datos de la fila
        const datosFilas = {
            'NumDefTest': numdeftest,
            'NumPrueba': numprueba,
            'campo': campotest,
            'Prueba': def[3],
            'Accion': acciontest,
            'valor': valortest,
            'Respuesta Test': resultadotest,
            'Respuesta esperada': `${respuestatest} (${this.traduccion(respuestatest)})`,
            'Resultado': resultadoestetest
        };
        
        // Construir la fila usando el nuevo método
        salidatest += this.dom.crearFilaTest(datosFilas);
    }

    // Presentar el resultado
    document.getElementById('salidaresultadosprueba').innerHTML = salidatest;
    document.getElementById('resultadopruebas').style.display = 'block';
    
    // Aplicar visibilidad inicial
    this.dom.actualizarVisibilidadColumnasTest();
  }

  /**
   * @method getCookie
   * @description Obtiene el valor de una cookie por su nombre
   * @param {string} name - Nombre de la cookie
   * @returns {string|null} Valor de la cookie o null si no existe
   */
  getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(";");

    for (var i = 0; i &lt; ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == " ") c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }

    return null;
  }

  /**
   * @method traduccion
   * @description Obtiene la traducción de un código según el idioma actual
   * @param {string} codigo - Código de traducción
   * @returns {string} Texto traducido
   */
  traduccion(codigo) {
    var lang = this.getCookie("lang");
    var traduccion;
    switch (lang) {
      case "ES":
        traduccion = textos_ES;
        break;
      case "EN":
        traduccion = textos_EN;
        break;
      default:
        traduccion = textos_ES;
        break;
    }
    return traduccion[codigo];
  }

  test_entidad_files() {
    this.validaciones = new Dom_validations(
      new Validaciones_Atomicas(),
      this.entidad
    );
    let salidatest = `&lt;tr>&lt;th>NumDefTest&lt;/th>&lt;th>NumPrueba&lt;/th>&lt;th>Campo&lt;/th>&lt;th>Prueba&lt;/th>&lt;th>Accion&lt;/th>&lt;th>valor&lt;/th>&lt;th>Respuesta Test&lt;/th>&lt;th>Respuesta esperada&lt;/th>&lt;th>Resultado&lt;/th>&lt;/tr>`;

    for (let i = 0; i &lt; this.array_tests_file.length; i++) {
      let campotest = this.array_tests_file[i][1];
      let numdeftest = this.array_tests_file[i][2];
      let numprueba = this.array_tests_file[i][3];
      let acciontest = this.array_tests_file[i][4];
      let clasedetest = this.array_tests_file[i][5];
      let valortest = this.array_tests_file[i][6];
      let respuestatest = this.array_tests_file[i][7];

      // Cargo formulario limpio
      this.instance.cargar_formulario(acciontest);
      let botonsumit = document.createElement("input");
      botonsumit.id = "submit_button";
      document.getElementById("IU_form").append(botonsumit);

      // Construyo objeto file y relleno valor para prueba
      if (valortest.length !== 0) {
        const file = new File([new ArrayBuffer(valortest[2])], valortest[0], {
          type: valortest[1],
          webkitRelativePath: "C:\\fakepath\\" + valortest[0],
        });

        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        const fileList = dataTransfer.files;
        document.getElementById(campotest).files = fileList;
      }

      // Coloco validaciones para la acción
      this.validaciones.load_validations(acciontest);

      // Llamo a comprobarCampo
      const resultadotest = this.validaciones.comprobarCampo(
        campotest,
        acciontest
      );

      // Compruebo si el resultado del test y la respuesta esperada es la misma
      const resultadoestetest =
        respuestatest === resultadotest ? "CORRECTO" : "INCORRECTO";

      const lineasalida = `&lt;tr>&lt;td>${numdeftest}&lt;/td>&lt;td>${numprueba}&lt;/td>&lt;td>${campotest}&lt;/td>&lt;td>${clasedetest}&lt;/td>&lt;td>${acciontest}&lt;/td>&lt;td>${valortest}&lt;/td>&lt;td>${resultadotest}&lt;/td>&lt;td>${respuestatest} (${this.traduccion(
        respuestatest
      )})&lt;/td>&lt;td>${resultadoestetest}&lt;/td>&lt;/tr>`;
      salidatest += lineasalida;
    }

    // presento el resultado
    document.getElementById("salidaresultadosprueba").innerHTML += salidatest;
    document.getElementById("resultadopruebas").style.display = "block";
  }

  /**
   * @method devolver_def
   * @description Devuelve la definición de un test por su número
   * @param {number} num_def - Número de la definición del test
   * @returns {Array} Definición del test
   */
  devolver_def(num_def) {
    for (let i = 0; i &lt; this.array_def.length; i++) {
      if (this.array_def[i][2] == num_def) {
        return this.array_def[i];
      }
    }
  }

  verificarDefTest() {
    let probe_def = eval(this.entidad + "_def_tests");
    let filacorrecta = true;

    let salidatabla =
      "&lt;tr>&lt;th>Entidad&lt;/>&lt;th>Campo&lt;/th>&lt;th>Num. DefTest&lt;/th>&lt;th colspan='7'>Datos&lt;/th>";
    let salidalinea = "";

    probe_def.forEach((element) => {
      salidalinea = "&lt;tr>";
      salidalinea += "&lt;td>" + element[0] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[1] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[2] + "&lt;/td>";
      filacorrecta = true;
      for (let i = 0; i &lt; 7; i++) {
        salidalinea += "&lt;td>" + typeof element[i] + "&lt;/td>";
      }
      if (
        typeof element[0] == "string" &amp;&amp;
        typeof element[1] == "string" &amp;&amp;
        typeof element[2] == "number" &amp;&amp;
        typeof element[3] == "string" &amp;&amp;
        typeof element[4] == "string" &amp;&amp;
        (typeof element[5] == "string" || typeof element[5] == "boolean") &amp;&amp;
        typeof element[6] == "string"
      ) {
        salidalinea += "&lt;td>CORRECTA&lt;/td>";
      } else {
        salidalinea += "&lt;td>ERROR&lt;/td>";
        filacorrecta = false;
      }
      salidalinea += "&lt;/tr>";
      salidatabla += salidalinea;
    });

    document.getElementById("tablaresultadostest").innerHTML += salidatabla;

    if (filacorrecta) {
      document.getElementById("resultadodeftest").className =
        "resultadodeftest";
    }

    document.getElementById("contenidoTests").style.display = "block";
  }

  /**
   * @method verificarPruebas
   * @description Verifica la estructura y tipos de datos de las pruebas
   */
  verificarPruebas() {
    let probe_def = eval(this.entidad + "_tests");
    let filacorrecta = true;

    let salidatabla =
      "&lt;tr>&lt;th>Entidad&lt;/>&lt;th>Campo&lt;/th>&lt;th>Num.Def&lt;/th>&lt;th>Num.Prob&lt;/th>&lt;th colspan='6'>Datos&lt;/th>";
    let salidalinea = "";

    probe_def.forEach((element) => {
      salidalinea = "&lt;tr>";
      salidalinea += "&lt;td>" + element[0] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[1] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[2] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[3] + "&lt;/td>";
      filacorrecta = true;
      for (let i = 0; i &lt; 7; i++) {
        salidalinea += "&lt;td>" + typeof element[i] + "&lt;/td>";
      }
      if (
        typeof element[0] == "string" &amp;&amp;
        typeof element[1] == "string" &amp;&amp;
        typeof element[2] == "number" &amp;&amp;
        typeof element[3] == "number" &amp;&amp;
        typeof element[4] == "string" &amp;&amp;
        typeof element[5] == "string" &amp;&amp;
        (typeof element[6] == "string" || typeof element[6] == "boolean")
      ) {
        salidalinea += "&lt;td>CORRECTA&lt;/td>";
      } else {
        salidalinea += "&lt;td>ERROR&lt;/td>";
        filacorrecta = false;
      }
      salidalinea += "&lt;/tr>";
      salidatabla += salidalinea;
    });

    document.getElementById("tablaresultadosprueba").innerHTML += salidatabla;

    if (filacorrecta) {
      document.getElementById("resultadodefpruebas").className =
        "resultadodefpruebas";
    }

    document.getElementById("contenidoPruebas").style.display = "block";
  }

  verificarPruebas_file() {
    let probe_def = eval(this.entidad + "_tests_files");
    let filacorrecta = true;

    let salidatabla =
      "&lt;tr>&lt;th>Entidad&lt;/>&lt;th>Campo&lt;/th>&lt;th>Num.Def&lt;/th>&lt;th>Num.Prob&lt;/th>&lt;th colspan='8'>Datos&lt;/th>";
    let salidalinea = "";

    probe_def.forEach((element) => {
      salidalinea = "&lt;tr>";
      salidalinea += "&lt;td>" + element[0] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[1] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[2] + "&lt;/td>";
      salidalinea += "&lt;td>" + element[3] + "&lt;/td>";
      filacorrecta = true;
      for (let i = 0; i &lt; 8; i++) {
        salidalinea += "&lt;td>" + typeof element[i] + "&lt;/td>";
      }
      if (
        typeof element[0] == "string" &amp;&amp;
        typeof element[1] == "string" &amp;&amp;
        typeof element[2] == "number" &amp;&amp;
        typeof element[3] == "number" &amp;&amp;
        typeof element[4] == "string" &amp;&amp;
        typeof element[5] == "string" &amp;&amp;
        (typeof element[6] == "object" || typeof element[6] == "string") &amp;&amp;
        (typeof element[7] == "string" || typeof element[7] == "boolean")
      ) {
        salidalinea += "&lt;td>CORRECTA&lt;/td>";
      } else {
        salidalinea += "&lt;td>ERROR&lt;/td>";
        filacorrecta = false;
      }
      salidalinea += "&lt;/tr>";
      salidatabla += salidalinea;
    });

    document.getElementById("tablaresultadosprueba").innerHTML += salidatabla;

    if (filacorrecta) {
      document.getElementById("resultadotest").className = "resultadotest";
    }

    document.getElementById("contenidoPruebas").style.display = "block";
  }
} //end class
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Dom.html">Dom</a></li><li><a href="Dom_validations.html">Dom_validations</a></li><li><a href="Entidad_Abstracta.html">Entidad_Abstracta</a></li><li><a href="ExternalAccess.html">ExternalAccess</a></li><li><a href="Validaciones_Atomicas.html">Validaciones_Atomicas</a></li><li><a href="analysis_preparation.html">analysis_preparation</a></li><li><a href="characteristic.html">characteristic</a></li><li><a href="project.html">project</a></li><li><a href="test_IU.html">test_IU</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ADD">ADD</a></li><li><a href="global.html#DELETE">DELETE</a></li><li><a href="global.html#EDIT">EDIT</a></li><li><a href="global.html#SEARCH">SEARCH</a></li><li><a href="global.html#abrirModalError">abrirModalError</a></li><li><a href="global.html#back_request">back_request</a></li><li><a href="global.html#cambiacolumnastabla">cambiacolumnastabla</a></li><li><a href="global.html#cambiarLang">cambiarLang</a></li><li><a href="global.html#cargar_formulario">cargar_formulario</a></li><li><a href="global.html#cerrarModalError">cerrarModalError</a></li><li><a href="global.html#cerrar_test">cerrar_test</a></li><li><a href="global.html#change_value_IU">change_value_IU</a></li><li><a href="global.html#check_special_test_END_DATE_PROJECT">check_special_test_END_DATE_PROJECT</a></li><li><a href="global.html#check_special_tests">check_special_tests</a></li><li><a href="global.html#comprobarCampo">comprobarCampo</a></li><li><a href="global.html#crearTablaDatos">crearTablaDatos</a></li><li><a href="global.html#createField">createField</a></li><li><a href="global.html#createForm">createForm</a></li><li><a href="global.html#createFormGenerico">createFormGenerico</a></li><li><a href="global.html#devolver_def">devolver_def</a></li><li><a href="global.html#file_type">file_type</a></li><li><a href="global.html#format_name_file">format_name_file</a></li><li><a href="global.html#getAttributes">getAttributes</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#hacertabla">hacertabla</a></li><li><a href="global.html#handleAddField">handleAddField</a></li><li><a href="global.html#handleEditField">handleEditField</a></li><li><a href="global.html#load_validations">load_validations</a></li><li><a href="global.html#max_size">max_size</a></li><li><a href="global.html#max_size_file">max_size_file</a></li><li><a href="global.html#max_size_name_file">max_size_name_file</a></li><li><a href="global.html#min_size">min_size</a></li><li><a href="global.html#min_size_name_file">min_size_name_file</a></li><li><a href="global.html#modificarColumnasTest">modificarColumnasTest</a></li><li><a href="global.html#modificarcolumnasamostrar">modificarcolumnasamostrar</a></li><li><a href="global.html#mostrar_error_campo">mostrar_error_campo</a></li><li><a href="global.html#no_file">no_file</a></li><li><a href="global.html#reg_exp">reg_exp</a></li><li><a href="global.html#resetColumnasTest">resetColumnasTest</a></li><li><a href="global.html#resolve_def_test">resolve_def_test</a></li><li><a href="global.html#resolve_pruebas">resolve_pruebas</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#setLang">setLang</a></li><li><a href="global.html#submit_test">submit_test</a></li><li><a href="global.html#test_run">test_run</a></li><li><a href="global.html#textos_EN">textos_EN</a></li><li><a href="global.html#textos_ES">textos_ES</a></li><li><a href="global.html#traduccion">traduccion</a></li><li><a href="global.html#validacionesespeciales">validacionesespeciales</a></li><li><a href="global.html#verificarPruebas">verificarPruebas</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Jun 15 2025 11:31:54 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
