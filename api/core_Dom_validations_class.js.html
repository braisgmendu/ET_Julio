<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/Dom_validations_class.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/Dom_validations_class.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class Dom_validations
 * @extends Dom
 * @description Clase que maneja las validaciones del DOM, extendiendo la funcionalidad de la clase Dom.
 * Esta clase implementa un sistema completo de validación de formularios que incluye:
 * - Validaciones atómicas (tamaño mínimo/máximo, expresiones regulares)
 * - Validaciones de archivos (tipo, tamaño, formato de nombre)
 * - Validaciones especiales por campo
 * - Validaciones específicas por acción (ADD, EDIT, SEARCH, DELETE)
 * 
 * @property {Validaciones_Atomicas} validaciones - Instancia de la clase de validaciones atómicas
 * @property {string} entidad - Nombre de la entidad que se está validando
 */
class Dom_validations extends Dom{
    /**
     * @constructor
     * @description Inicializa la clase de validaciones con las dependencias necesarias.
     * Configura el contexto de validación para una entidad específica y asegura que
     * el método comprobarCampo esté disponible globalmente.
     * 
     * @param {Validaciones_Atomicas} validaciones - Instancia de la clase de validaciones atómicas
     * @param {string} entidad - Nombre de la entidad a validar
     */
    constructor(validaciones, entidad) {
        super();
        this.validaciones = validaciones;
        this.entidad = entidad;
        window.comprobarCampo = this.comprobarCampo.bind(this) // Asegura que comprobarCampo esté disponible globalmente
    }

    /**
     * @method getAttributes
     * @description Obtiene la estructura de atributos definida para la entidad actual.
     * Evalúa dinámicamente la estructura de la entidad para obtener sus atributos
     * y reglas de validación.
     * 
     * @returns {Object} Objeto con la definición de atributos de la entidad
     */
    getAttributes() {
        let atributos;

        atributos = eval('estructura_'+this.entidad+'.attributes'); 
        return atributos;
    }
    

    /**
     * @method load_validations
     * @description Carga y configura las validaciones para todos los campos del formulario.
     * Asigna eventos de validación apropiados según el tipo de campo:
     * - 'onblur' para inputs normales
     * - 'onchange' para otros elementos
     * 
     * @param {string} action - Acción para la que cargar las validaciones (ADD, EDIT, SEARCH, DELETE)
     */
    load_validations(action) {
        const elementos = document.forms['IU_form'].elements;
        for (let elemento of elementos) {
            const tipoElemento = document.getElementById(elemento.id).type;
            const etiqueta = document.getElementById(elemento.id).tagName;
            const evento = (etiqueta === 'INPUT' &amp;&amp; tipoElemento !== 'file') ? 'onblur' : 'onchange';
            const funcionValidacion = () => {
                this.comprobarCampo(elemento.id, action);
            };
            document.getElementById(elemento.id).addEventListener(evento, funcionValidacion);
        }
    }

    /**
     * @method comprobarCampo
     * @description Realiza la validación completa de un campo específico.
     * El proceso de validación incluye:
     * 1. Verificación de existencia de definiciones para el campo
     * 2. Validación especial genérica
     * 3. Manejo específico para campos de archivo
     * 4. Validaciones según la acción (SEARCH, ADD, EDIT)
     * 
     * Tipos de validaciones soportadas:
     * - min_size: Tamaño mínimo
     * - max_size: Tamaño máximo
     * - reg_exp: Expresión regular
     * - valid_date: Validación de fecha
     * - no_file: Verificación de archivo
     * - max_size_file: Tamaño máximo de archivo
     * - file_type: Tipo de archivo
     * - format_name_file: Formato del nombre de archivo
     * - min_size_name_file: Tamaño mínimo del nombre de archivo
     * - max_size_name_file: Tamaño máximo del nombre de archivo
     * 
     * @param {string} campo - ID del campo a validar
     * @param {string} action - Acción que se está realizando (ADD, EDIT, SEARCH, DELETE)
     * @returns {boolean|string} true si el campo es válido, mensaje de error en caso contrario
     */
    comprobarCampo(campo, action) {
        const atributos = this.getAttributes();
        
        if (!atributos[campo]) {
            console.warn(`No se pueden comprobar validaciones porque no existen definiciones para la acción: ${action}`);
            return true;
        }

        // Obtener elemento DOM
        const elemento = document.getElementById(campo);
        if (!elemento) return true;

        // Determinar valor del campo
        let valor;
        if (elemento instanceof HTMLInputElement &amp;&amp; elemento.type === 'file') {
            valor = elemento.files.length > 0 ? elemento.files[0] : null;
        } else {
            valor = elemento.value ? elemento.value.trim() : '';
        }

        const validacionesCampo = atributos[campo]?.validation_rules;
        if (!validacionesCampo) {
            console.warn(`No hay validaciones definidas para el campo: ${campo} y acción: ${action}`);
            return true;
        }

        // 2. Validación especial genérica
        const resultadoEspecial = this.check_special_tests(campo);
        if (resultadoEspecial !== true) {
            this.mostrar_error_campo(campo, resultadoEspecial || `Error especial en el campo: ${campo}`);
            return resultadoEspecial;
        }

        // 3. Manejo genérico de campos de archivo en EDIT
        const esCampoArchivo = elemento instanceof HTMLInputElement &amp;&amp; elemento.type === 'file';
        if (esCampoArchivo &amp;&amp; action === 'EDIT' &amp;&amp; !valor) {
            return true;
        }

        const reglasAccion = validacionesCampo[action] || {};
        
        // Si es SEARCH y no hay valor, permitir la búsqueda
        if (action === 'SEARCH' &amp;&amp; !valor) {
            return true;
        }

        // Si es SEARCH y hay valor, validar según las reglas
        if (action === 'SEARCH' &amp;&amp; valor) {
            for (const [tipoValidacion, config] of Object.entries(reglasAccion)) {
                let resultado = false;
                let valorValidacion, mensaje;

                if (Array.isArray(config)) {
                    [valorValidacion, mensaje] = config;
                } else {
                    mensaje = config;
                }

                try {
                    switch (tipoValidacion) {
                        case 'max_size':
                            resultado = this.validaciones.max_size(campo, valorValidacion);
                            break;
                        case 'reg_exp':
                            resultado = this.validaciones.reg_exp(campo, valorValidacion);
                            break;
                    }
                } catch (error) {
                    console.error(`Error en validación ${tipoValidacion} para ${campo}:`, error);
                    continue;
                }

                if (resultado === false) {
                    this.mostrar_error_campo(campo, mensaje || `Error en validación ${tipoValidacion}`);
                    return mensaje || `Error en campo ${campo}`;
                }
            }
            
        }

        // Para otras acciones (ADD, EDIT)
        for (const [tipoValidacion, config] of Object.entries(reglasAccion)) {
            let resultado = false;
            let valorValidacion, mensaje;

            if (Array.isArray(config)) {
                [valorValidacion, mensaje] = config;
            } else {
                mensaje = config;
            }

            try {
                switch (tipoValidacion) {
                    case 'min_size':
                        resultado = this.validaciones.min_size(campo, valorValidacion);
                        break;
                    case 'max_size':
                        resultado = this.validaciones.max_size(campo, valorValidacion);
                        break;
                    case 'reg_exp':
                        resultado = this.validaciones.reg_exp(campo, valorValidacion);
                        break;
                    case 'valid_date':
                        resultado = this.validacionesespeciales(campo, valorValidacion);
                        break;
                    case 'no_file':
                        resultado = this.validaciones.no_file(valor);
                        break;
                    case 'max_size_file':
                        if (valor) {
                            resultado = this.validaciones.max_size_file(valor, valorValidacion);
                        }
                        break;
                    case 'file_type':
                        if (valor) {
                            resultado = this.validaciones.file_type(valor, valorValidacion);
                        }
                        break;
                    case 'format_name_file':
                        if (valor) {
                            resultado = this.validaciones.format_name_file(valor, valorValidacion);
                        }
                        break;
                    case 'min_size_name_file':
                        if (valor) {
                            resultado = this.validaciones.min_size_name_file(valor, valorValidacion);
                        }
                        break;
                    case 'max_size_name_file':
                        if (valor) {
                            resultado = this.validaciones.max_size_name_file(valor, valorValidacion);
                        }
                        break;
                    default:
                        console.error(`Tipo de validación no soportado: ${tipoValidacion}`);
                        continue;
                }
            } catch (error) {
                console.error(`Error en validación ${tipoValidacion} para ${campo}:`, error);
                continue;
            }

            if (resultado === false) {
                this.mostrar_error_campo(campo, mensaje || `Error en validación ${tipoValidacion}`);
                return mensaje || `Error en campo ${campo}`;
            }
        }

        return true;
    }

    /**
     * @method submit_test
     * @description Realiza una validación completa de todos los campos del formulario.
     * Proceso:
     * 1. Obtiene todos los atributos con reglas de validación
     * 2. Filtra los atributos que tienen reglas para la acción específica
     * 3. Valida cada campo
     * 4. Recopila y reporta errores
     * 
     * @param {string} action - Acción para la que validar (ADD, EDIT, SEARCH, DELETE)
     * @returns {boolean} true si todos los campos son válidos, false si hay errores
     */
    submit_test(action) {
        const atributos = this.getAttributes();
    
        if (!atributos) {
            console.error(`No se encontraron atributos para validaciones.`);
            return false; // No se puede proceder sin definiciones
        }
    
        // Filtrar atributos que tienen reglas de validación para la acción específica
        const atributosFiltrados = Object.keys(atributos).filter(campo => {
            const reglas = atributos[campo]?.validation_rules;
            return reglas &amp;&amp; reglas[action]; // Validar solo si hay reglas para la acción
        });
    
        const errores = atributosFiltrados.map(campo => {
            const resultado = this.comprobarCampo(campo, action);
            if (resultado != true) {
                console.error(`Error en el campo "${campo}": ${resultado}`);
            }
            return resultado; // Devolver el mensaje de error o true
        });
    
        // Comprobar si todos los campos pasaron (todos deben devolver `true`)
        const hayErrores = errores.some(resultado => resultado !== true);
    
        return !hayErrores; // Retornar `false` si hubo errores, `true` si todo está correcto
    }

    /**
     * @method check_special_tests
     * @description Verifica y ejecuta validaciones especiales para un atributo específico.
     * Las validaciones especiales son métodos dinámicos que siguen el patrón
     * 'check_especial_tests_[nombre_atributo]'.
     * 
     * @param {string} atributo - Nombre del atributo a validar
     * @returns {boolean|string} true si no hay validaciones especiales o si pasan, mensaje de error en caso contrario
     */
    check_special_tests(atributo) {
        const methodName = `check_especial_tests_${atributo}`;

        if (typeof this[methodName] === 'function') {
            return this[methodName]();
        }else {
            //console.warn(`No hay un método especial definido para el campo: ${atributo}`);
            return true; // Si no hay método, asumimos que es válido
        }
    }

    /**
     * @method validacionesespeciales
     * @description Realiza validaciones especiales para campos específicos.
     * Actualmente implementa validaciones especiales para:
     * - start_date_project: Validación de fecha de inicio
     * - end_date_project: Validación de fecha de fin
     * 
     * Las validaciones incluyen:
     * - Verificación de formato de fecha
     * - Validación de rangos de días y meses
     * - Comparación de fechas (para end_date_project)
     * 
     * @param {string} atributo - Nombre del atributo a validar
     * @param {string} tipoValidacion - Tipo de validación especial a realizar
     * @returns {boolean} true si la validación es exitosa, false en caso contrario
     */
    validacionesespeciales(atributo, tipoValidacion) {
        if (['start_date_project', 'end_date_project'].includes(atributo)) {
            if (tipoValidacion === 'fechavalida') {
                let fecha = document.getElementById(atributo).value;
                let fechaf = fecha.split("/");
                let day = fechaf[0];
                let month = fechaf[1];
                let year = fechaf[2];
                let date = new Date(year,month,'0'); //
                
                if((month - 0)&lt;= 0 || (month -0)> 12){
                    return false;
                }
                
                if((day-0)>(date.getDate()-0)){
                    return false;
                }
                
                return true;
            }
            return false;
        }   
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Dom.html">Dom</a></li><li><a href="Dom_validations.html">Dom_validations</a></li><li><a href="Entidad_Abstracta.html">Entidad_Abstracta</a></li><li><a href="ExternalAccess.html">ExternalAccess</a></li><li><a href="Validaciones_Atomicas.html">Validaciones_Atomicas</a></li><li><a href="analysis_preparation.html">analysis_preparation</a></li><li><a href="characteristic.html">characteristic</a></li><li><a href="project.html">project</a></li><li><a href="test_IU.html">test_IU</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ADD">ADD</a></li><li><a href="global.html#DELETE">DELETE</a></li><li><a href="global.html#EDIT">EDIT</a></li><li><a href="global.html#SEARCH">SEARCH</a></li><li><a href="global.html#abrirModalError">abrirModalError</a></li><li><a href="global.html#back_request">back_request</a></li><li><a href="global.html#cambiacolumnastabla">cambiacolumnastabla</a></li><li><a href="global.html#cambiarLang">cambiarLang</a></li><li><a href="global.html#cargar_formulario">cargar_formulario</a></li><li><a href="global.html#cerrarModalError">cerrarModalError</a></li><li><a href="global.html#cerrar_test">cerrar_test</a></li><li><a href="global.html#change_value_IU">change_value_IU</a></li><li><a href="global.html#check_special_test_END_DATE_PROJECT">check_special_test_END_DATE_PROJECT</a></li><li><a href="global.html#check_special_tests">check_special_tests</a></li><li><a href="global.html#comprobarCampo">comprobarCampo</a></li><li><a href="global.html#crearTablaDatos">crearTablaDatos</a></li><li><a href="global.html#createField">createField</a></li><li><a href="global.html#createForm">createForm</a></li><li><a href="global.html#createFormGenerico">createFormGenerico</a></li><li><a href="global.html#devolver_def">devolver_def</a></li><li><a href="global.html#file_type">file_type</a></li><li><a href="global.html#format_name_file">format_name_file</a></li><li><a href="global.html#getAttributes">getAttributes</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#hacertabla">hacertabla</a></li><li><a href="global.html#handleAddField">handleAddField</a></li><li><a href="global.html#handleEditField">handleEditField</a></li><li><a href="global.html#load_validations">load_validations</a></li><li><a href="global.html#max_size">max_size</a></li><li><a href="global.html#max_size_file">max_size_file</a></li><li><a href="global.html#max_size_name_file">max_size_name_file</a></li><li><a href="global.html#min_size">min_size</a></li><li><a href="global.html#min_size_name_file">min_size_name_file</a></li><li><a href="global.html#modificarColumnasTest">modificarColumnasTest</a></li><li><a href="global.html#modificarcolumnasamostrar">modificarcolumnasamostrar</a></li><li><a href="global.html#mostrar_error_campo">mostrar_error_campo</a></li><li><a href="global.html#no_file">no_file</a></li><li><a href="global.html#reg_exp">reg_exp</a></li><li><a href="global.html#resetColumnasTest">resetColumnasTest</a></li><li><a href="global.html#resolve_def_test">resolve_def_test</a></li><li><a href="global.html#resolve_pruebas">resolve_pruebas</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#setLang">setLang</a></li><li><a href="global.html#submit_test">submit_test</a></li><li><a href="global.html#test_run">test_run</a></li><li><a href="global.html#textos_EN">textos_EN</a></li><li><a href="global.html#textos_ES">textos_ES</a></li><li><a href="global.html#traduccion">traduccion</a></li><li><a href="global.html#validacionesespeciales">validacionesespeciales</a></li><li><a href="global.html#verificarPruebas">verificarPruebas</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Jun 15 2025 11:31:54 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
